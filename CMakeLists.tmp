cmake_minimum_required(VERSION 3.2.0 FATAL_ERROR)
project(libxutils LANGUAGES C)

IF (WIN32)
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} /Od /W3")
ELSE()
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -g -O2 -Wall")
ENDIF()

set(THREADS_PREFER_PTHREAD_FLAG ON)
find_package(Threads REQUIRED)

find_package(OpenSSL)
IF(OpenSSL_FOUND)
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -D_XUTILS_USE_SSL")
ENDIF()

SET(HEADER_DST "include/xutils")
SET(SOURCE_DIR "./src")
SET(MEDIA_DIR "./media")
include_directories(${SOURCE_DIR} ${MEDIA_DIR})

add_library(xutils STATIC
    _SOURCE_LIST_
)

install(TARGETS xutils DESTINATION lib)

install(DIRECTORY "${SOURCE_DIR}/"
        DESTINATION "${HEADER_DST}"
        FILES_MATCHING
        PATTERN "*.h"
)

install(DIRECTORY "${MEDIA_DIR}/"
        DESTINATION "${HEADER_DST}"
        FILES_MATCHING
        PATTERN "*.h"
)
